<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Mini Translate Offscreen</title>
</head>
<body>
    <script>
        // Offscreen Document ç½‘ç»œè¯·æ±‚å¤„ç†å™¨
        console.log('ğŸ” Offscreen Document å·²åŠ è½½');

        // ç›‘å¬æ¥è‡ªService Workerçš„æ¶ˆæ¯
        self.onmessage = async (event) => {
            const { type, requestId, url, options } = event.data;
            
            console.log('ğŸ” Offscreen æ”¶åˆ°æ¶ˆæ¯:', { type, requestId, url });

            if (type === 'FETCH_REQUEST') {
                try {
                    console.log('ğŸ” å¼€å§‹æ‰§è¡Œfetchè¯·æ±‚:', { url, options });
                    
                    const response = await fetch(url, options);
                    const responseText = await response.text();
                    
                    let responseData;
                    try {
                        responseData = JSON.parse(responseText);
                    } catch {
                        responseData = responseText;
                    }
                    
                    console.log('âœ… Fetchè¯·æ±‚æˆåŠŸ:', { 
                        status: response.status, 
                        ok: response.ok 
                    });
                    
                    // å‘é€æˆåŠŸå“åº”
                    self.postMessage({
                        type: 'FETCH_RESPONSE',
                        requestId: requestId,
                        success: true,
                        data: {
                            ok: response.ok,
                            status: response.status,
                            statusText: response.statusText,
                            headers: Object.fromEntries(response.headers.entries()),
                            json: responseData,
                            text: responseText
                        }
                    });
                    
                } catch (error) {
                    console.log('âŒ Fetchè¯·æ±‚å¤±è´¥:', error);
                    
                    // å‘é€é”™è¯¯å“åº”
                    self.postMessage({
                        type: 'FETCH_RESPONSE',
                        requestId: requestId,
                        success: false,
                        error: error.message
                    });
                }
            }
        };

        // é€šçŸ¥Service Worker Offscreen Documentå·²å‡†å¤‡å°±ç»ª
        self.postMessage({
            type: 'OFFSCREEN_READY'
        });
    </script>
</body>
</html>
