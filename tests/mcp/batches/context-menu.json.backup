{
  "metadata": {
    "name": "mini-translate-context-menu",
    "description": "Validate add/remove/start-stop context menu scenes"
  },
  "setup": {
    "notes": [
      "Load dist/ extension and capture its ID automatically via npm run mcp:capture.",
      "Navigate to a content page containing the phrases defined in sample data (e.g. https://example.com)."
    ]
  },
  "steps": [
    {
      "tool": "new_page",
      "params": {
        "url": "https://example.com"
      }
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { var s=document.createElement('script'); s.src='chrome-extension://nmmhkkegccagdldgiimedpiccmgmieda/qa-bridge.js'; document.documentElement.appendChild(s); await new Promise(r=>setTimeout(r,500)); }"
      },
      "notes": "在普通页面注入 QA Bridge"
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { if(!window.__miniTranslateQA){ throw new Error('QA bridge not available'); } await window.__miniTranslateQA.applyTerm('Example Domain','示例域'); await new Promise(r=>setTimeout(r,300)); }"
      },
      "notes": "通过桥接新增词条"
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { await window.__miniTranslateQA.toggle(); await new Promise(r=>setTimeout(r,200)); }"
      },
      "notes": "切换翻译状态"
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { const input = document.getElementById('qa-term-input'); input.value = 'Example Domain'; document.getElementById('qa-add').click(); await new Promise(r => setTimeout(r, 300)); }"
      },
      "notes": "通过 QA 面板添加词条"
    },
    {
      "tool": "wait_for",
      "params": {
        "text": "已添加词条"
      }
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { document.getElementById('qa-toggle').click(); await new Promise(r => setTimeout(r, 200)); }"
      },
      "notes": "切换翻译状态"
    },
    {
      "tool": "wait_for",
      "params": {
        "text": "已开启页面翻译 (QA)"
      }
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { document.getElementById('qa-term-input').value = 'Example Domain'; document.getElementById('qa-remove').click(); await new Promise(r => setTimeout(r, 300)); }"
      },
      "notes": "通过 QA 面板移除词条"
    },
    {
      "tool": "wait_for",
      "params": {
        "text": "已移除词条"
      }
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { await window.__miniTranslateQA.removeTerm('Example Domain'); await new Promise(r=>setTimeout(r,300)); }"
      },
      "notes": "移除词条"
    },
    {
      "tool": "wait_for",
      "params": {
        "text": "词库为空"
      }
    },
    {
      "tool": "take_screenshot",
      "params": {
        "path": "@artifact/context-menu/context-menu-scenes.png"
      }
    }
  ],
  "teardown": {
    "notes": [
      "Restore selection and clear QA helpers via evaluate_script if necessary."
    ]
  }
}
