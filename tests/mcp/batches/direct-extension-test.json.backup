{
  "metadata": {
    "name": "direct-extension-test",
    "description": "Direct test of extension functionality without relying on content script injection"
  },
  "setup": {
    "notes": [
      "Test extension directly through its options page and background script."
    ]
  },
  "steps": [
    {
      "tool": "new_page",
      "params": {
        "url": "chrome-extension://acfpkkkhehadjlkdnffdkoilmhchefbl/options.html"
      }
    },
    {
      "tool": "wait_for",
      "params": {
        "text": "Mini Translate",
        "timeout": 10000
      }
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { const title = document.title; const bodyText = document.body.innerText; console.log('Page title:', title); console.log('Body text:', bodyText.substring(0, 200)); return { title, bodyText: bodyText.substring(0, 200) }; }"
      },
      "notes": "检查扩展选项页面内容"
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { const inputs = document.querySelectorAll('input'); const buttons = document.querySelectorAll('button'); console.log('Found inputs:', inputs.length); console.log('Found buttons:', buttons.length); return { inputs: inputs.length, buttons: buttons.length }; }"
      },
      "notes": "检查页面元素"
    },
    {
      "tool": "take_screenshot",
      "params": {
        "path": "@artifact/direct-extension-test/options-page.png"
      }
    },
    {
      "tool": "new_page",
      "params": {
        "url": "https://example.com"
      }
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { document.body.innerHTML = '<div>Hello World</div><div>Example Domain</div>'; const text = 'Hello World'; const selection = window.getSelection(); const range = document.createRange(); const textNode = document.querySelector('div').firstChild; range.selectNode(textNode); selection.removeAllRanges(); selection.addRange(range); console.log('Selected:', selection.toString()); return selection.toString(); }"
      },
      "notes": "设置测试页面并选中文本"
    },
    {
      "tool": "evaluate_script",
      "params": {
        "function": "async () => { const event = new MouseEvent('contextmenu', { bubbles: true, cancelable: true, clientX: 100, clientY: 100 }); document.dispatchEvent(event); console.log('Context menu event dispatched'); return 'Context menu triggered'; }"
      },
      "notes": "触发右键菜单"
    },
    {
      "tool": "wait_for",
      "params": {
        "text": "Add to vocabulary",
        "timeout": 5000
      }
    },
    {
      "tool": "take_screenshot",
      "params": {
        "path": "@artifact/direct-extension-test/context-menu.png"
      }
    }
  ],
  "teardown": {
    "notes": [
      "Extension functionality test completed"
    ]
  }
}
