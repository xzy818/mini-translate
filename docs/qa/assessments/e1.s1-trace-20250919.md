# Requirements Traceability Matrix

## Story: E1.S1 — 右键菜单与页面翻译开关

### Coverage Summary

- Total Requirements: 3
- Fully Covered: 1 (33%)
- Partially Covered: 2 (67%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: 单一菜单入口按场景互斥展示 add/remove/start/stop

**Coverage: FULL**

- Test: `tests/context-menu.test.js` — `shows add action when selection not in vocabulary`
  - Given: 词库为空且提供有效选区
  - When: 触发 `chrome.contextMenus.onShown`
  - Then: 菜单标题更新为 `add & mini-translate` 且点击执行添加逻辑

- Test: `tests/context-menu.test.js` — `shows remove action when selection exists in vocabulary`
  - Given: 词库包含当前选区词条
  - When: 触发 `onShown`
  - Then: 菜单标题为 `remove from mini-translate` 且点击执行移除

#### AC2: 未选区时根据 tab 状态互斥展示 `start/stop`

**Coverage: PARTIAL**

- Test: `tests/context-menu.test.js` — `shows start/stop based on tab state`
  - Given: 初始 tab 状态 disabled
  - When: 用户点击菜单切换
  - Then: `toggleTabState` 被调用，通知展示“已开启/已关闭”文案

- Gap: 缺少真实浏览器中带 500 词库压力下的响应时间与文案更新验证（见 Scenario E1.S1-E2E-001）

#### AC3: 添加/移除词条即时作用于页面并发出通知

**Coverage: PARTIAL**

- Test: `tests/context-menu.test.js` — `shows add action when selection not in vocabulary`
  - Given: 有效模型配置
  - When: 点击菜单执行添加
  - Then: `tabs.sendMessage` 收到 `APPLY_TRANSLATION` 指令，词库增加

- Test: `tests/context-menu.test.js` — `shows remove action when selection exists in vocabulary`
  - Given: 词库含该词
  - When: 点击菜单执行移除
  - Then: `tabs.sendMessage` 收到 `REMOVE_TRANSLATION`，词库删除

- Gap: 缺少端到端验证（content script 实际替换/恢复 DOM、通知权限确认），需手动测试 Scenario E1.S1-E2E-002

### Critical Gaps

1. **AC2 端到端性能**
   - Gap: 未验证真实环境下菜单刷新时间与互斥切换
   - Severity: Medium
   - Suggested Test: 执行 Scenario E1.S1-E2E-001（Chrome 手动回归）

2. **AC3 浏览器联动**
   - Gap: 未验证 content script 实际翻译/恢复效果
   - Severity: Medium
   - Suggested Test: 执行 Scenario E1.S1-E2E-002（端到端手动测试）

### Test Design Recommendations

- 先跑 P0 单测后，安排手动端到端覆盖 AC2/AC3。
- 记录浏览器版本、菜单响应时间，补充到 QA 记录与 Issue #21。
- 发布前保留测试数据与回滚计划。

Trace matrix: docs/qa/assessments/e1.s1-trace-20250919.md
