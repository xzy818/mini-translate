# mini-translate 产品需求文档（PRD）

## 1. 背景与目标
- **项目愿景**：打造一个轻量、非侵入式的 Chrome 智能翻译插件，仅翻译用户词库中的生词，帮助阅读英文网页时快速掌握重点。
- **主要目标**：
  1. 提供上下文感知的翻译体验，不打断阅读流程。
  2. 通过生词库的管理与导入导出来满足不同学习阶段用户的需求。
  3. 支持多种高质量翻译模型，并允许用户自行配置。
  4. 发布时提供可直接安装的 Chrome 扩展打包件。

## 2. 目标用户
- 有一定英语基础、希望精读或泛读英文网页的用户。
- 语言学习者，需要积累与复习个人词汇表。
- 对翻译准确性有较高要求的专业人士。

## 3. 用户场景
1. **网页阅读即时翻译**：用户开启 mini-translate 后，页面中的生词将自动替换为译文。
2. **生词即时收集**：用户浏览网页时可选中生词，右键加入词库并即时翻译。
3. **译文回退**：对已经翻译的词，用户可右键移除，从而恢复原文并更新词库。
4. **词库管理**：在插件管理界面查看、生词导入导出、删除词条。
5. **翻译模型配置**：根据成本或效果需要，在多种模型中切换并管理 API Key。
6. **插件安装**：用户从 release 下载离线包，直接在 Chrome 中加载使用。
7. **快捷配置弹窗**：用户点击扩展图标后即可在弹窗内快速调整翻译配置、查看词库概览。

## 4. 需求范围
### 4.1 功能需求
**Epic E1：mini-translate 核心能力**
- Story S1：右键菜单与即时翻译动作
  - 仅在选中文本时展示扩展菜单：
    - 原文选中 → `add & mini-translate`
    - 已翻译选中 → `remove from mini-translate`
  - 未选中文本时不显示扩展菜单，避免冗余入口。
  - 点击后调用背景脚本和内容脚本完成翻译或回退。
- Story S2：词库存储与限制
  - 词库条目结构：原文、译文、类型（单词/短语）、长度、添加时间戳等。
  - 存储于 `chrome.storage.local`，总数 ≤500；超过限制需提示并阻止。
- Story S3：翻译服务抽象
  - 设置页允许选择模型：DeepSeek V3、Qwen MT Turbo、Qwen MT Plus、gpt-4o-mini。
  - 支持配置 Base URL、API Key，统一调用接口并处理错误。

**Epic E2：管理界面与词库运营**
- Story S4：词库列表 UI
  - 管理页顶部显示词表；>10 条时提供折叠/分页；行内显示类型、长度、时间戳、删除按钮。
  - 支持批量删除功能：提供全选复选框、行内复选框、批量删除按钮，支持用户快速批处理删除词条。
- Story S5：API/模型配置模块
  - 管理页底部展示模型选择、API Key、Base URL，提供密钥遮挡与保存。
- Story S6：导入导出
  - TXT：一行一个词或短语。
  - JSON：约定 schema（见章节 4.2）。
  - 导入需去重、校验词条，同时遵守 500 条上限并给出反馈。
- Story S9：图标弹窗快捷面板
  - 点击扩展图标后弹出小窗口，提供翻译模型配置、词库概览、导入导出入口。
  - 弹窗与管理页共用存储、提示与验证逻辑，确保数据实时同步。

**Epic E3：资产与文档**
- Story S7：白底蓝字 MT 图标（变更后）
  - 采用白底蓝色"MT"字标作为品牌识别，输出 128/48/32/16 等尺寸（PNG），并提供 SVG 源文件。
- Story S8：文档与 Release
  - README 更新模型支持、词库限制、导入格式、打包说明。
  - Release 中包含可直接在 Chrome 安装的扩展压缩包。

**Epic E4：Google账号同步**
- Story S10：Google账号认证与同步基础
  - 集成Chrome Identity API，支持Google账号登录/登出。
  - 在设置页面提供Google登录状态显示和管理。
  - 实现登录状态持久化和状态变化监听。
- Story S11：云端数据同步
  - 使用`chrome.storage.sync` API实现生词表数据跨设备同步。
  - 实现增量同步机制，提高同步效率。
  - 支持离线使用，在线时自动同步数据。
- Story S12：数据冲突解决
  - 检测多设备间的数据冲突。
  - 提供智能自动冲突解决策略（时间戳优先、完整性优先）。
  - 在无法自动解决时，提供用户手动选择界面。

### 4.2 数据需求
- 词库 JSON schema（初稿，详见 PO 文档）：
  ```json
  {
    "term": "string",
    "translation": "string",
    "type": "word" | "phrase",
    "length": number,
    "createdAt": ISOString,
    "lastUsedAt": ISOString | null,
    "deviceId": "string",
    "lastModified": ISOString,
    "version": number
  }
  ```
- 设置数据：`{ apiBaseUrl, apiKey, model, googleAuth }`。
- 页面状态：已翻译节点标识。
- 同步数据：
  ```json
  {
    "vocabulary": {
      "items": [...],
      "lastModified": ISOString,
      "version": number,
      "deviceId": "string"
    },
    "settings": {
      "apiKey": "string",
      "model": "string",
      "lastModified": ISOString
    },
    "syncStatus": {
      "lastSyncTime": ISOString,
      "conflictCount": number,
      "pendingChanges": boolean
    }
  }
  ```

### 4.3 非功能需求
- **性能**：翻译脚本需避免阻塞主线程，通过批量或异步遍历 DOM。
- **可逆性**：停止翻译时能够恢复原文文本。
- **安全性**：API Key 仅存储于本地，UI 中默认遮挡，提供复制按钮。
- **可用性**：界面在 1280×720 分辨率下保持清晰；右键菜单响应 ≤500ms。
- **兼容性**：支持最新版桌面 Chrome 浏览器。
- **同步性能**：数据同步延迟 ≤5秒，支持离线使用。
- **数据一致性**：多设备间数据冲突解决时间 ≤10秒。
- **存储限制**：遵守Chrome存储配额限制（100KB），实现数据压缩。

### 4.4 范围外
- 不实现移动端浏览器插件。
- 不提供自动发音或语音朗读功能。
- 不提供第三方云存储服务集成（仅使用Chrome内置同步）。

### 4.5 测试与发布要求
- 发布前必须执行完整的测试套件，确保所有功能正常工作。
- Release checklist 需记录测试执行人、时间与结果，确保可追溯。

## 5. 里程碑
| 里程碑 | 内容 | 负责人 |
| --- | --- | --- |
| M1 | 完成 PRD、架构、词库 schema 并评审通过 | PM/Architect/PO |
| M2 | 完成 E1 核心翻译能力开发与自测 | Dev |
| M3 | 完成管理界面、导入导出、翻译服务封装 | Dev/QA |
| M4 | 完成图标、文档、打包流程并发布 Release | Dev/PO |
| M5 | 完成 Google 账号同步功能开发与测试 | Dev/QA |

## 6. 风险与应对
- **翻译 API 限流**：预置退避重试策略，提示用户检查配额。
- **DOM 替换导致渲染异常**：严格过滤节点类型，并保持原文缓存。
- **词库上限触发体验差**：在 UI 中加入计数提示，建议用户清理或导出备份。
- **Release 打包遗漏**：构建脚本中加入检查并列出需包含文件。
- **Chrome 存储配额限制**：实现数据压缩和清理机制，优化存储使用。
- **同步冲突处理**：提供智能冲突解决策略，必要时提供用户选择界面。
- **网络异常导致同步失败**：实现重试机制和本地缓存，确保离线可用。

## 7. 验收标准概览
- 右键菜单仅在选中文本时出现，并正确区分"添加/移除"两种状态。
- 添加词条后页面立即展示译文，移除词条后恢复原文。
- 词库 CRUD 与导入导出均遵守 500 条限制。
- 管理界面顶部显示词表、底部为模型与 Key 配置；扩展图标弹窗可快速访问同等操作。
- 支持四种模型调用，错误处理清晰。
- Google 账号登录后，生词表数据能够跨设备自动同步。
- 数据冲突时能够智能解决或提供用户选择界面。
- 同步过程对用户透明，不影响正常使用。
- Release 发布包含可本地安装的 Chrome 扩展包。
